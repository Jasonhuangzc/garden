# 🌻 花园自动种花功能 - 使用说明

## ✅ 功能已完成

你的词汇花园现在有了**54个可种植的格子**（6行×9列），购买花朵后会**自动按顺序种植**！

---

## 🎯 核心功能

### 1. 动态花园网格
- 📐 **6行×9列 = 54个格子**
- 🟫 空格子显示棕色泥土
- 🟢 已种植格子显示绿色草地
- 📊 实时显示进度：例如 "5/54 planted"

### 2. 自动种植顺序
**从左到右，从上到下**依次填充：
```
第1朵花 → 格子0  (第1行第1个)
第2朵花 → 格子1  (第1行第2个)
第3朵花 → 格子2  (第1行第3个)
...
第9朵花 → 格子8  (第1行第9个)
第10朵花 → 格子9 (第2行第1个)
...以此类推
```

### 3. 精美动画效果
- 🎬 **花朵生长动画**：旋转+缩放（0.6秒）
- ✨ **格子悬停效果**：鼠标移入时高亮
- 🎨 **渐变色彩**：棕→绿的状态变化

---

## 🚀 如何使用

### 步骤1：启动服务器
本地服务器已经在运行：
```
地址：http://localhost:8000
```

### 步骤2：打开页面
在浏览器访问：
```
http://localhost:8000/index.html
```

### 步骤3：开始种花

#### 方法A：使用真实数据
1. **背单词获得积分**
   - 打开"不背单词"APP
   - 背诵单词（1个单词=1积分）

2. **收取积分转化为金币**
   - 等待数据同步（每10分钟自动同步）
   - 或手动刷新页面
   - 点击底部状态栏的"Reward"按钮
   - 积分会转化为金币（例如：10积分 → 10金币）

3. **购买花朵**
   - 在花店选择花朵（每朵5金币）
   - 点击"Redeem"按钮
   - 花朵自动种植到下一个空格子

#### 方法B：使用测试数据（快速测试）
打开浏览器控制台（按F12），运行：
```javascript
// 1. 手动添加金币（仅用于测试）
await window.gameDebug.claimPoints('user2');

// 2. 购买花朵
await window.gameDebug.buyFlower('rose');      // 购买玫瑰
await window.gameDebug.buyFlower('sunflower'); // 购买向日葵
await window.gameDebug.buyFlower('tulip');     // 购买郁金香
```

---

## 🎮 完整游戏流程示例

假设你购买了3朵花：

```
初始状态：
┌─────────────────────────────────┐
│ My Garden          0/54 planted │
├─────────────────────────────────┤
│ [ ][ ][ ][ ][ ][ ][ ][ ][ ]     │
│ [ ][ ][ ][ ][ ][ ][ ][ ][ ]     │
│ [ ][ ][ ][ ][ ][ ][ ][ ][ ]     │
│ [ ][ ][ ][ ][ ][ ][ ][ ][ ]     │
│ [ ][ ][ ][ ][ ][ ][ ][ ][ ]     │
│ [ ][ ][ ][ ][ ][ ][ ][ ][ ]     │
└─────────────────────────────────┘

购买玫瑰后：
┌─────────────────────────────────┐
│ My Garden          1/54 planted │
├─────────────────────────────────┤
│ [🌹][ ][ ][ ][ ][ ][ ][ ][ ]    │  ← 自动种在格子0
│ [ ][ ][ ][ ][ ][ ][ ][ ][ ]     │
│ [ ][ ][ ][ ][ ][ ][ ][ ][ ]     │
│ [ ][ ][ ][ ][ ][ ][ ][ ][ ]     │
│ [ ][ ][ ][ ][ ][ ][ ][ ][ ]     │
│ [ ][ ][ ][ ][ ][ ][ ][ ][ ]     │
└─────────────────────────────────┘

购买向日葵后：
┌─────────────────────────────────┐
│ My Garden          2/54 planted │
├─────────────────────────────────┤
│ [🌹][🌻][ ][ ][ ][ ][ ][ ][ ]   │  ← 自动种在格子1
│ [ ][ ][ ][ ][ ][ ][ ][ ][ ]     │
│ [ ][ ][ ][ ][ ][ ][ ][ ][ ]     │
│ [ ][ ][ ][ ][ ][ ][ ][ ][ ]     │
│ [ ][ ][ ][ ][ ][ ][ ][ ][ ]     │
│ [ ][ ][ ][ ][ ][ ][ ][ ][ ]     │
└─────────────────────────────────┘

购买郁金香后：
┌─────────────────────────────────┐
│ My Garden          3/54 planted │
├─────────────────────────────────┤
│ [🌹][🌻][🌷][ ][ ][ ][ ][ ][ ]  │  ← 自动种在格子2
│ [ ][ ][ ][ ][ ][ ][ ][ ][ ]     │
│ [ ][ ][ ][ ][ ][ ][ ][ ][ ]     │
│ [ ][ ][ ][ ][ ][ ][ ][ ][ ]     │
│ [ ][ ][ ][ ][ ][ ][ ][ ][ ]     │
│ [ ][ ][ ][ ][ ][ ][ ][ ][ ]     │
└─────────────────────────────────┘
```

---

## 🧪 测试工具

### 打开测试脚本
在浏览器控制台（F12）运行：
```javascript
// 加载测试脚本
const script = document.createElement('script');
script.src = 'test_garden.js';
document.head.appendChild(script);
```

### 可用的测试命令
```javascript
// 运行所有自动化测试
gardenTest.runAllTests();

// 查看所有格子状态（表格形式）
gardenTest.tools.viewAllPlots();

// 查看已种植的花
gardenTest.tools.viewPlantedFlowers();

// 高亮特定格子（例如格子5）
gardenTest.tools.highlightPlot(5);

// 测试购买功能
gardenTest.testBuyFlower();
```

---

## 📱 视觉效果

### 花朵生长动画
```
0.0秒: 花朵从格子中心开始，完全透明
       ↓ (旋转+缩放)
0.4秒: 放大到120%（弹跳效果）
       ↓
0.6秒: 恢复到100%，完全显示
```

### 格子颜色
- **空格子**：棕色泥土 (#8D6E63 → #A1887F)
- **已种植**：绿色草地 (#689F38 → #8BC34A)

---

## 🐛 常见问题

### Q1：花园网格不显示？
**原因**：可能使用了 `file://` 协议打开
**解决**：
```bash
# 确保使用本地服务器
python serve.py

# 然后访问
http://localhost:8000/index.html
```

### Q2：购买后花朵没有显示？
**检查清单**：
1. ✅ 金币是否足够（至少5个）
2. ✅ 控制台是否有错误（按F12查看）
3. ✅ Firebase连接是否正常
4. ✅ 刷新页面试试（Ctrl+F5）

### Q3：花朵显示位置不对？
**原因**：背景图的等距比例与预设参数有微小差异。
**解决**：
我们采用了**绝对定位系统**，你可以精确控制每个格子的位置。
打开 `script.js`，找到顶部的 `GRID_LAYOUT` 配置：

```javascript
const GRID_LAYOUT = {
    START_X: 50,      // 第一个格子的水平位置 (%)
    START_Y: 10,      // 第一个格子的垂直位置 (%)
    
    // 间距微调
    STEP_X_X: 5.9,    // 向右移动时的水平跨度
    STEP_X_Y: 3.4,    // 向右移动时的垂直跨度
    // ...
};
```
调整这些数值即可完美对齐你的背景图！

---

## 📊 技术细节

### 核心改进 (v2.0)
- ✅ **移除3D变换**：彻底解决了花朵变扁、拉伸的问题。
- ✅ **绝对定位系统**：使用数学公式 `Screen = Origin + (Grid * Step)` 精确计算位置。
- ✅ **所见即所得**：花朵现在以原图比例显示，清晰度最高。

### 修改的文件
1. **style.css** - 移除了 `rotateX`/`rotateZ`，改回平面布局。
2. **script.js** - 引入了 `GRID_LAYOUT` 和新的坐标计算逻辑。

### 数据存储（Firestore）
不变，依然兼容现有的数据结构。

### 新增文件
1. **GARDEN_FEATURE.md** - 详细技术文档
2. **GARDEN_QUICKSTART.md** - 快速开始指南
3. **GARDEN_IMPLEMENTATION.md** - 实现报告
4. **test_garden.js** - 测试工具脚本
5. **本文档** - 中文使用说明

### 数据存储（Firestore）
```javascript
garden/plots {
  maxPlots: 54,          // 总格子数
  occupiedPlots: 3,      // 已种植数
  grid: [                // 54个格子的数组
    {
      id: 0,
      flower: "rose",
      flowerName: "玫瑰花苞",
      flowerImage: "image/image (4).png",
      plantedAt: "2026-01-28T10:00:00Z",
      plantedBy: "user2"
    },
    // ... 更多格子
  ]
}
```

---

## ✅ 验证清单

使用前请确认：
- [ ] 本地服务器正在运行（http://localhost:8000）
- [ ] 页面能正常打开
- [ ] 能看到6行×9列的格子
- [ ] 金币显示正常
- [ ] 可以点击购买按钮

---

## 🎯 下一步建议

### 立即可以做的事
1. ✅ 测试购买第一朵花
2. ✅ 观察种植动画效果
3. ✅ 尝试种满第一行（9朵花）
4. ✅ 查看已种植数量变化

### 未来可以扩展的功能
1. 🔮 点击格子查看花朵详细信息
2. 🔮 花朵随时间生长（花苗→开花→盛开）
3. 🔮 主题切换（春夏秋冬）
4. 🔮 花园装饰系统

---

## 📞 需要帮助？

### 查看文档
- `GARDEN_QUICKSTART.md` - 快速开始
- `GARDEN_FEATURE.md` - 完整功能说明
- `GARDEN_IMPLEMENTATION.md` - 技术实现细节

### 调试工具
```javascript
// 查看游戏状态
window.gameDebug.getState()

// 手动同步数据
window.gameDebug.syncData()

// 重新加载
window.gameDebug.reload()
```

---

**🎉 现在你可以开始种花了！祝你玩得愉快！🌻🌷🌹🌺**

---

*最后更新：2026-01-28 17:44*  
*开发：Antigravity AI*
